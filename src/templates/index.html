<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高品质音乐无损解析</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <!-- 外部资源 -->
    <script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script>
    <script type="module" src="{{ url_for('static', filename='js/browser-id3-writer.min.js') }}"></script>
    <link rel="stylesheet" href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/aplayer/1.10.1/APlayer.min.css">
    <!-- 引用外部CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- 右侧设置侧边栏 -->
    <div id="settings-sidebar" class="settings-sidebar">
        <!-- 侧边栏内容（与原HTML一致） -->
        <div class="sidebar-header">
            <h3>网站设置</h3>
            <button id="closeSettings" class="close-btn">关闭</button>
        </div>
        <div class="sidebar-content">
            <!-- 扫码功能验证 -->
            <div class="settings-section qr-auth-section">
                <h4><span class="section-icon">🔒</span> 扫码功能验证</h4>
                <div id="password-container" class="settings-group">
                    <label for="qr-password">请输入密码以启用扫码功能</label>
                    <input type="password" id="qr-password" class="form-control" placeholder="输入密码">
                    <button id="verify-password" class="btn btn-primary" style="margin-top: 10px;">验证密码</button>
                    <p id="password-error" style="color: #f44336; font-size: 0.8rem; margin-top: 5px;">密码错误，请重试</p>
                </div>
                <!-- 扫码功能区域 - 默认隐藏 -->
                <div id="qr-feature-container" class="qr-feature-container" style="display: none; opacity: 0; transition: opacity 0.5s ease-in-out;">
                    <h4><span class="section-icon">📱</span> 二维码登录</h4>
                    <!-- 倒计时显示 -->
                    <div class="settings-group">
                        <label>二维码有效期</label>
                        <div class="countdown-display" id="countdown-display">3:00</div>
                        <p style="text-align:center; font-size:0.8rem; color:#666; margin-top:5px;">
                            请在倒计时结束前完成扫描
                        </p>
                    </div>
                    <!-- 二维码生成与显示 -->
                    <div class="settings-group">
                        <button id="generate-qr-btn" class="btn btn-primary">生成登录二维码</button>
                        <div class="qr-code-container">
                            <img id="qr-code-image" class="qr-code-image" src="" alt="登录二维码">
                            <p id="qr-placeholder" style="color: #999;">点击上方按钮生成二维码</p>
                            <p id="login-status" style="margin-top:10px; font-size:0.9rem; color:#666;"></p>
                        </div>
                    </div>
                    <!-- 扫描结果显示 -->
                    <div class="settings-group">
                        <label for="scan-result">登录凭证 (Cookie)</label>
                        <textarea id="scan-result" class="form-control" rows="3" placeholder="扫描二维码并确认后显示"></textarea>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button id="copy-cookie-btn" class="btn btn-secondary" style="flex:1;">复制</button>
                            <button id="clear-cookie-btn" class="btn btn-secondary" style="flex:1;">清除</button>
                        </div>
                    </div>
                </div>
            </div>  
            <!-- 分隔线 -->
            <div class="sidebar-divider"></div>
            <!-- 支持与捐赠 -->
            <div class="settings-section">
                <h4><span class="section-icon">💖</span> 支持与捐赠</h4>
                <div class="settings-group">
                    <label for="payment-method">选择支付方式</label>
                    <select id="payment-method" class="form-control">
                        <option value="wechat">微信支付</option>
                        <option value="alipay">支付宝</option>
                    </select>
                    <div class="payment-qr-container">
                        <img id="payment-qr-image" class="payment-qr-image" 
                                src="{{ url_for('static', filename='wechat.png') }}" alt="微信收款码">
                    </div>
                    <p style="text-align: center; font-size: 0.9rem; color: #666;">
                        感谢您的支持，您的捐赠将帮助我们持续改进服务
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <div id="main-content">
        <!-- 顶部导航 -->
        <header>
            <div class="container header-content">
                <h1 class="logo">高品质音乐无损解析</h1>
                <button id="openSettings" class="settings-btn">设置</button>
            </div>
        </header>

        <!-- 主要内容 -->
        <main class="container">
            <!-- 卡片A：大标题 -->
            <div class="card title-card">
                <h2>高品质音乐解析下载</h2>
                <p>轻松获取无损音质音乐</p>
            </div>

            <!-- 卡片B：选择解析方式 -->
            <div class="card options-card">
                <h3>选择解析方式</h3>
                <div class="options-grid">
                    <div class="parse-option active" data-type="链接解析">
                        <div>
                            <div class="option-icon">链接</div>
                            <div>链接解析</div>
                        </div>
                    </div>
                    <div class="parse-option active" data-type="歌单解析">
                        <div>
                            <div class="option-icon">歌单</div>
                            <div>歌单解析</div>
                        </div>
                    </div>
                    <div class="parse-option" data-type="专辑解析">
                        <div>
                            <div class="option-icon">专辑</div>
                            <div>专辑解析</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 卡片C：解析区域 -->
            <div id="parse-card" class="card parse-card">
                <h3 id="parse-title">链接解析</h3>
                <div>
                    <div class="form-group">
                        <label for="parse-input" id="input-label">链接解析</label>
                        <input type="text" id="parse-input" class="form-control" placeholder="请输入音乐链接">
                    </div>
                    <!-- 自定义音质选择下拉框 -->
                    <div class="form-group">
                        <label>音质选择</label>
                        <div class="select-container">
                            <div id="quality-display" class="select-display">
                                <span>无损音质</span>
                                <span>▼</span>
                            </div>
                            <div id="quality-options" class="select-options">
                                <div class="quality-option select-option" data-value="hires">
                                    <span>Hi-Res</span>
                                </div>
                                <div class="quality-option select-option active" data-value="lossless">
                                    <span>无损音质</span>
                                    <span class="badge badge-recommend">推荐</span>
                                </div>
                                <div class="quality-option select-option" data-value="exhigh">
                                    <span>极高音质</span>
                                </div>
                                <div class="quality-option select-option" data-value="standard">
                                    <span>标准音质</span>
                                </div>
                                <div class="quality-option select-option" data-value="sky">
                                    <span>沉浸环绕声</span>
                                </div>
                                <div class="select-option" data-value="jymaster">
                                    <span>超清母带</span>
                                </div>
                            </div>
                            <input type="hidden" id="quality-select" value="lossless">
                        </div>
                    </div>
                    <!-- 解析按钮 -->
                    <button id="parse-button" class="btn btn-primary">开始解析</button>
                </div>
            </div>

            <!-- 卡片D：解析结果 -->
            <div id="result-card" class="card result-card">
                <div id="back-to-playlist-container" style="display: none;">
                    <div class="back-link" id="back-to-playlist">
                        <span class="back-text">←</span> 返回歌单列表
                    </div>
                </div>
                <!-- 歌单专辑解析结果模板 -->
                <div id="playlist-result" style="display: none;">
                    <div class="result-header">
                        <div>
                            <h3>歌曲列表</h3>
                            <p class="result-stats" id="playlist-stats"></p>
                        </div>
                        <div class="result-actions">
                            <button id="batchDownloadBtn" class="btn btn-success">批量下载本页</button>
                        </div>
                    </div>
                    <div class="result-meta" id="playlist-meta"></div>
                    <div id="song-list" class="song-list"></div>
                    <div class="pagination" id="pagination">
                        <button id="prev-page" class="page-item" disabled>←</button>
                        <div id="page-numbers" class="page-numbers"></div>
                        <button id="next-page" class="page-item">→</button>
                    </div>
                </div>
                <!-- 单首歌曲解析结果模板 -->
                <div id="single-result" style="display: none;">
                    <input type="hidden" id="download_id" value="">
                    <input type="hidden" id="download_quality" value="">
                    <div>
                        <h3 class="song-title" id="single-song-title"></h3>
                        <p class="song-artist" id="single-song-artist"></p>
                    </div>
                    <hr>
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <span class="info-label">专辑：</span>
                                <span class="info-value" id="single-album"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">音质：</span>
                                <span class="info-value" id="single-quality"></span>
                            </div>
                        </div>
                        <div>
                            <div class="info-item">
                                <span class="info-label">时长：</span>
                                <span class="info-value" id="single-duration"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">大小：</span>
                                <span class="info-value" id="single-size"></span>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="action-buttons">
                        <button id="show-big-pic" class="btn btn-secondary">查看封面大图</button>
                        <button type="button" id="download-btn" class="btn btn-success">下载音乐</button>
                    </div>
                    <div id="download-progress" class="song-progress">
                        <div class="progress-bar-container">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div style="text-align: center; margin-top: 5px;">
                            <small style="color: #666;">正在下载并写入元信息...</small>
                        </div>
                    </div>
                    <div style="margin-top: 20px;" id="aplayer-container"></div>
                </div>
            </div>

            <!-- 底部信息卡片 -->
            <div class="card" style="margin-top: 30px;">
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #666; font-size: 1.1rem; margin-bottom: 10px;">免责声明</h3>
                    <p style="font-size: 0.9rem; color: #666; line-height: 1.6;">
                        本工具仅用于学习交流，所有音乐资源均来自网络，版权归原作者及唱片公司所有。
                        请支持正版音乐，下载后请在24小时内删除，请勿用于商业用途。
                        如侵犯到您的权益，请联系我们删除。
                    </p>
                </div>
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #666; font-size: 1.1rem; margin-bottom: 10px;">相关链接</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <a href="https://github.com/Nothend/MusicLover" target="_blank" style="color: #42a5f5; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center;">
                            <span style="margin-right: 5px;">🔗</span> GitHub源码
                        </a>
                        <a href="https://github.com/Nothend/MusicLover/issues" style="color: #42a5f5; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center;">
                            <span style="margin-right: 5px;">📧</span> 联系我们
                        </a>
                        <a href="#" style="color: #42a5f5; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center;">
                            <span style="margin-right: 5px;">📜</span> 使用条款
                        </a>
                    </div>
                </div>
                <div style="text-align: center; font-size: 0.8rem; color: #999; margin-top: 20px; padding-top: 10px; border-top: 1px dashed #e0e0e0;">
                    © 2023 高品质音乐无损解析 | 仅供学习交流使用
                </div>
            </div>
        </main>
    </div>

    <!-- 大图预览模态框 -->
    <div id="bigPicModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1001; align-items: center; justify-content: center;">
        <div style="background: white; padding: 20px; border-radius: 8px; max-width: 90%;">
            <button id="closeBigPic" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: white;">×</button>
            <div style="text-align: center;">
                <img id="big-pic-img" src="" alt="封面大图" style="max-width: 100%; max-height: 80vh;">
            </div>
        </div>
    </div>

    <!-- 引用外部JS（注意type="module"保持不变） -->
    <script type="module" src="{{ url_for('static', filename=js_main_file) }}"></script>
</body>
</html>